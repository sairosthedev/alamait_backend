# Test Cases & Real-Life Scenarios

## üß™ **Test Cases for Request Creation**

### **Test Case 1: Student Maintenance Request**
```javascript
// Request
POST /api/requests
{
  "title": "Broken Light Switch",
  "description": "Light switch in room 205 is not working",
  "type": "maintenance",
  "residence": "507f1f77bcf86cd799439011",
  "room": "205",
  "category": "electrical",
  "priority": "medium"
}

// Expected Response
{
  "status": 201,
  "data": {
    "_id": "507f1f77bcf86cd799439012",
    "title": "Broken Light Switch",
    "status": "pending",
    "financeStatus": "pending",
    "submittedBy": "student_user_id",
    "type": "maintenance"
  }
}
```

### **Test Case 2: Admin Operational Request with Items**
```javascript
// Request
POST /api/requests
{
  "title": "Security Camera Installation",
  "description": "Install security cameras around the residence",
  "type": "operational",
  "residence": "507f1f77bcf86cd799439011",
  "department": "Security",
  "requestedBy": "Security Manager",
  "deliveryLocation": "Main Gate",
  "items": [
    {
      "description": "Security Camera",
      "quantity": 8,
      "unitCost": 1500,
      "purpose": "Surveillance cameras"
    },
    {
      "description": "Installation Service",
      "quantity": 1,
      "unitCost": 5000,
      "purpose": "Professional installation"
    }
  ],
  "priority": "high"
}

// Expected Response
{
  "status": 201,
  "data": {
    "_id": "507f1f77bcf86cd799439013",
    "totalEstimatedCost": 17000,
    "status": "pending",
    "approval": {
      "admin": { "approved": true },
      "finance": { "approved": false },
      "ceo": { "approved": false }
    }
  }
}
```

## üè¢ **Real-Life Scenarios**

### **Scenario 1: Student Maintenance Request Flow**

**Background**: Sarah, a student in Room 101, reports a leaking faucet.

**Step 1: Request Creation**
```javascript
// Sarah creates maintenance request
POST /api/requests
{
  "title": "Leaking Kitchen Faucet",
  "description": "Water is leaking from the kitchen faucet in room 101",
  "type": "maintenance",
  "residence": "residence_a_id",
  "room": "101",
  "category": "plumbing",
  "priority": "medium"
}
```

**Step 2: Admin Uploads Quotations**
```javascript
// Admin uploads quotations from different plumbers
POST /api/requests/request_id/quotations
FormData: {
  provider: "Trust Jings Plumbing",
  amount: 2500,
  description: "Complete faucet replacement",
  file: quotation_file.pdf
}

POST /api/requests/request_id/quotations
FormData: {
  provider: "Gift Fashu Plumber",
  amount: 1800,
  description: "Faucet repair service",
  file: quotation_file2.pdf
}
```

**Step 3: Auto-Vendor Creation**
```javascript
// System auto-creates vendors
{
  "vendor1": {
    "businessName": "Trust Jings Plumbing",
    "vendorCode": "200001",
    "vendorType": "contractor",
    "category": "plumbing",
    "paymentMethod": "Cash",
    "isAutoGenerated": true
  },
  "vendor2": {
    "businessName": "Gift Fashu Plumber",
    "vendorCode": "200002",
    "vendorType": "contractor",
    "category": "plumbing",
    "paymentMethod": "Cash",
    "isAutoGenerated": true
  }
}
```

**Step 4: Finance Approval**
```javascript
// Finance approves the cheaper quotation
POST /api/requests/request_id/finance-approval
{
  "approved": true,
  "notes": "Approved Gift Fashu Plumber - best value",
  "selectedQuotationId": "quotation2_id"
}
```

**Step 5: CEO Approval**
```javascript
// CEO gives final approval
POST /api/requests/request_id/ceo-approval
{
  "approved": true,
  "notes": "Approved for immediate action"
}
```

**Step 6: Expense Conversion**
```javascript
// System automatically converts to expense
{
  "expenseId": "EXP2024001",
  "amount": 1800,
  "category": "Maintenance",
  "paymentStatus": "Pending",
  "maintenanceRequestId": "request_id"
}
```

**Step 7: Payment Processing**
```javascript
// Admin marks expense as paid
POST /api/expenses/expense_id/mark-paid
{
  "paymentMethod": "Cash",
  "paidBy": "admin_user_id",
  "paidDate": "2024-01-20"
}
```

**Step 8: Financial Recording**
```javascript
// System creates transaction entries
{
  "transaction": {
    "transactionId": "TXN2024001",
    "amount": 1800,
    "type": "expense"
  },
  "entries": [
    {
      "account": "Maintenance Expenses",
      "debit": 1800,
      "credit": 0,
      "type": "expense"
    },
    {
      "account": "Cash",
      "debit": 0,
      "credit": 1800,
      "type": "asset"
    }
  ]
}
```

### **Scenario 2: Admin Operational Request with Bank Transfer**

**Background**: Admin needs to purchase office equipment with bank transfer payment.

**Step 1: Request Creation**
```javascript
POST /api/requests
{
  "title": "Office Equipment Purchase",
  "description": "Purchase new computers and printers for admin office",
  "type": "operational",
  "residence": "residence_a_id",
  "department": "IT",
  "requestedBy": "IT Manager",
  "deliveryLocation": "Admin Building",
  "items": [
    {
      "description": "Desktop Computer",
      "quantity": 5,
      "unitCost": 8000,
      "purpose": "Staff workstations"
    },
    {
      "description": "Laser Printer",
      "quantity": 2,
      "unitCost": 3000,
      "purpose": "Document printing"
    }
  ],
  "priority": "high"
}
```

**Step 2: Quotation with Bank Details**
```javascript
POST /api/requests/request_id/quotations
FormData: {
  provider: "Tech Solutions Ltd",
  amount: 46000,
  description: "Complete office equipment package",
  file: quotation_file.pdf
}

// System auto-creates vendor with bank details
{
  "businessName": "Tech Solutions Ltd",
  "vendorCode": "200003",
  "vendorType": "shop",
  "category": "equipment",
  "bankDetails": {
    "bankName": "Standard Bank",
    "accountNumber": "1234567890",
    "accountType": "Business Account"
  },
  "paymentMethod": "Bank Transfer",
  "isAutoGenerated": true
}
```

**Step 3: Payment Processing**
```javascript
POST /api/expenses/expense_id/mark-paid
{
  "paymentMethod": "Bank Transfer",
  "paidBy": "finance_user_id",
  "paidDate": "2024-01-25"
}

// System creates transaction entries for bank transfer
{
  "entries": [
    {
      "account": "Equipment Expenses",
      "debit": 46000,
      "credit": 0,
      "type": "expense"
    },
    {
      "account": "Bank Account",
      "debit": 0,
      "credit": 46000,
      "type": "asset"
    }
  ]
}
```

## üéØ **Validation Test Cases**

### **Test Case 3: Invalid Student Request**
```javascript
// Missing required fields
POST /api/requests
{
  "title": "Test Request",
  "description": "Test description"
  // Missing: type, residence
}

// Expected Response
{
  "status": 400,
  "error": "Missing required fields: type, residence"
}
```

### **Test Case 4: Duplicate Request Detection**
```javascript
// Student tries to create duplicate request
POST /api/requests
{
  "title": "Leaking Faucet",
  "description": "Same description as existing request",
  "type": "maintenance",
  "residence": "residence_a_id",
  "room": "101",
  "category": "plumbing"
}

// Expected Response
{
  "status": 400,
  "error": "A similar request already exists in your residence",
  "existingRequestId": "existing_request_id"
}
```

### **Test Case 5: Permission Validation**
```javascript
// Student tries to create operational request
POST /api/requests
{
  "title": "Office Equipment",
  "description": "Need new equipment",
  "type": "operational", // Students can only create maintenance
  "residence": "residence_a_id"
}

// Expected Response
{
  "status": 400,
  "error": "Students can only submit maintenance requests"
}
```

## üìä **Financial Integration Test Cases**

### **Test Case 6: Transaction Entry Creation**
```javascript
// When expense is marked as paid
POST /api/expenses/expense_id/mark-paid
{
  "paymentMethod": "Cash",
  "amount": 2500
}

// Expected Transaction Entries
{
  "transaction": {
    "transactionId": "TXN2024002",
    "amount": 2500,
    "type": "expense"
  },
  "entries": [
    {
      "account": "Maintenance Expenses",
      "debit": 2500,
      "credit": 0
    },
    {
      "account": "Cash",
      "debit": 0,
      "credit": 2500
    }
  ]
}
```

### **Test Case 7: Vendor AP Account Creation**
```javascript
// When vendor is auto-created
{
  "vendor": {
    "businessName": "New Vendor",
    "vendorCode": "200004",
    "chartOfAccountsCode": "200004"
  },
  "account": {
    "code": "200004",
    "name": "Accounts Payable - New Vendor",
    "type": "Liability"
  }
}
```

## üîÑ **Workflow Test Cases**

### **Test Case 8: Complete Approval Flow**
```javascript
// 1. Create request
POST /api/requests
// 2. Upload quotations
POST /api/requests/request_id/quotations
// 3. Finance approval
POST /api/requests/request_id/finance-approval
// 4. CEO approval
POST /api/requests/request_id/ceo-approval
// 5. Check expense creation
GET /api/expenses?maintenanceRequestId=request_id
// 6. Mark as paid
POST /api/expenses/expense_id/mark-paid
// 7. Verify transaction entries
GET /api/transactions/entries?transaction=transaction_id
```

These test cases and scenarios provide comprehensive coverage of the request-to-payment flow system, ensuring proper validation, error handling, and financial integration. 