# Vendor Update Scripts - Complete Guide

## ðŸŽ¯ **Overview**

These scripts help update existing vendors in your database with the new fields added to the auto-vendor creation system. The scripts will add missing fields and ensure all vendors have proper payment method logic.

## ðŸ“‹ **What the Scripts Do**

### **1. Update Existing Vendors Script**
- Adds `vendorType` field based on category
- Adds `businessScope` field describing vendor specialization
- Adds `bankDetails` field (null for existing vendors)
- Adds `defaultPaymentMethod` field (Cash for existing vendors)
- Adds `expenseCategory` field (converted from expenseAccountCode)
- Adds `isAutoGenerated` flag (false for existing vendors)

### **2. Add Bank Details Script**
- Adds bank details to specific vendors
- Updates payment method to 'Bank Transfer' when bank details are added
- Maintains audit trail in vendor history

### **3. List Vendors Without Bank Details**
- Shows all vendors that don't have bank details
- Helps identify which vendors need bank information

## ðŸš€ **How to Run the Scripts**

### **Prerequisites**
1. Make sure MongoDB is running
2. Set your MongoDB connection string in environment variable `MONGODB_URI`
3. Or the script will use default: `mongodb://localhost:27017/alamait_backend`

### **Step 1: Update All Existing Vendors**
```bash
node update_existing_vendors.js update
```

**This will:**
- Add missing fields to all existing vendors
- Set appropriate vendor types based on categories
- Set payment method to 'Cash' (no bank details)
- Add audit trail entries

### **Step 2: Add Bank Details to Specific Vendors**
```bash
node update_existing_vendors.js add-bank-details
```

**This will:**
- Add bank details to the vendors specified in the script
- Update payment method to 'Bank Transfer'
- Add audit trail entries

### **Step 3: List Vendors Without Bank Details**
```bash
node update_existing_vendors.js list-no-bank
```

**This will:**
- Show all vendors that don't have bank details
- Display their current payment methods

## ðŸ“Š **Expected Results**

### **Before Running Scripts**
Your existing vendors look like this:
```javascript
{
    _id: "688c9c858e2ef0e7c3a6256d",
    vendorCode: "V25001",
    businessName: "Trust Jings Electrician",
    category: "electrical",
    chartOfAccountsCode: "200001",
    expenseAccountCode: "5000"
    // Missing: vendorType, businessScope, bankDetails, defaultPaymentMethod, expenseCategory
}
```

### **After Running Scripts**
Your vendors will look like this:
```javascript
{
    _id: "688c9c858e2ef0e7c3a6256d",
    vendorCode: "V25001",
    businessName: "Trust Jings Electrician",
    category: "electrical",
    vendorType: "contractor",                    // â† Added
    businessScope: "contractor specializing in electrical services/products", // â† Added
    chartOfAccountsCode: "200001",
    expenseCategory: "maintenance_expenses",     // â† Added (converted from expenseAccountCode)
    bankDetails: {                               // â† Added
        bankName: null,
        accountNumber: null,
        accountType: null,
        branchCode: null,
        swiftCode: null
    },
    defaultPaymentMethod: "Cash",                // â† Added
    isAutoGenerated: false                       // â† Added
}
```

## ðŸ·ï¸ **Vendor Type Mapping**

The script automatically determines vendor types:

| Category | Vendor Type | Business Scope |
|----------|-------------|----------------|
| `supplies`, `equipment` | `shop` | shop specializing in supplies/equipment services/products |
| `maintenance`, `cleaning`, `security`, `landscaping`, `electrical`, `plumbing`, `carpentry`, `painting` | `contractor` | contractor specializing in [category] services/products |
| `services` | `service_provider` | service_provider specializing in services services/products |
| `other` | `other` | other specializing in other services/products |

## ðŸ’³ **Payment Method Logic**

### **Auto-Determination Rules**
1. **Bank Transfer**: If vendor has complete bank details (bank name + account number)
2. **Vendor Preference**: If vendor has specified default payment method
3. **Cash**: Default for vendors without bank details

### **Existing Vendors**
- **Default**: `Cash` (no bank details provided)
- **Reason**: Existing vendors don't have bank account information
- **Manual Update**: Bank details can be added later to change payment method

## ðŸ”§ **Customizing Bank Details**

To add bank details to specific vendors, edit the `vendorBankDetails` object in the script:

```javascript
const vendorBankDetails = {
    "Trust Jings Electrician": {
        bankName: "CBZ Bank",
        accountNumber: "1234567890",
        accountType: "Business Account",
        branchCode: "12345",
        swiftCode: "CBZAZW2X"
    },
    "Gift Fashu Plumber": {
        bankName: "Stanbic Bank",
        accountNumber: "0987654321",
        accountType: "Business Account",
        branchCode: "54321",
        swiftCode: "SBICZMWX"
    }
    // Add more vendors as needed
};
```

## ðŸ“ˆ **Sample Output**

### **Running Update Script**
```
ðŸ”— Connecting to MongoDB...
âœ… Connected to MongoDB successfully
ðŸ“Š Found 4 vendors to update

ðŸ”„ Processing vendor: Trust Jings Electrician
   âž• Adding vendorType: contractor
   âž• Adding businessScope: contractor specializing in electrical services/products
   âž• Adding bankDetails: null (no bank details)
   âž• Adding defaultPaymentMethod: Cash
   âž• Adding expenseCategory: maintenance_expenses (from expenseAccountCode: 5000)
   âž• Adding isAutoGenerated: false
   âœ… Updated vendor: Trust Jings Electrician

ðŸ“ˆ Update Summary:
   âœ… Updated: 4 vendors
   â­ï¸  Skipped: 0 vendors
   ðŸ“Š Total processed: 4 vendors
```

### **Running Bank Details Script**
```
ðŸ”„ Processing vendor: Trust Jings Electrician
   âœ… Updated vendor: Trust Jings Electrician with bank details
   ðŸ’³ Bank Details:
      Bank: CBZ Bank
      Account: 1234567890
      Payment Method: Bank Transfer

ðŸ“ˆ Bank Details Update Summary:
   âœ… Updated: 3 vendors with bank details
   â­ï¸  Skipped: 1 vendors (already had bank details)
```

## ðŸ›¡ï¸ **Safety Features**

1. **No Data Loss**: Scripts only add missing fields, don't overwrite existing data
2. **Audit Trail**: All changes are logged in vendor history
3. **Error Handling**: Individual vendor failures don't stop the entire process
4. **Dry Run**: Scripts show what will be updated before making changes
5. **Backup Recommended**: Always backup your database before running scripts

## ðŸ” **Verification**

After running the scripts, verify the updates:

```javascript
// Check if all vendors have the new fields
const vendors = await Vendor.find({});
vendors.forEach(vendor => {
    console.log(`${vendor.businessName}:`);
    console.log(`  vendorType: ${vendor.vendorType}`);
    console.log(`  paymentMethod: ${vendor.defaultPaymentMethod}`);
    console.log(`  hasBankDetails: ${!!(vendor.bankDetails && vendor.bankDetails.bankName)}`);
});
```

## ðŸŽ¯ **Next Steps**

1. **Run the update script** to add missing fields
2. **Add bank details** to vendors who need bank transfers
3. **Test the auto-vendor creation** with new requests
4. **Monitor payment methods** in quotations and expenses

The scripts will ensure all your existing vendors are compatible with the new auto-vendor creation system! ðŸŽ¯ 